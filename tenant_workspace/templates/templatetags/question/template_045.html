{% load staticfiles i18n compress foundation_public_tags %}
<!-- JS -->
{% compress js inline %}
<script>
    $(document).ready(function () {
        //------------------------//
        // MATERIALS TEXT CHANGE  //
        //------------------------//
        $('#id_materials_yr1').bind('input',function(){
            calculate_yr1();
        });
        $('#id_materials_yr2').bind('input',function(){
            calculate_yr2();
        });
        $('#id_materials_yr3').bind('input',function(){
            calculate_yr3();
        });

        //------------------------//
        // LABOUR TEXT CHANGE  //
        //------------------------//
        $('#id_labour_yr1').bind('input',function(){
            calculate_yr1();
        });
        $('#id_labour_yr2').bind('input',function(){
            calculate_yr2();
        });
        $('#id_labour_yr3').bind('input',function(){
            calculate_yr3();
        });

        //------------------------//
        // OVERHEAD TEXT CHANGE  //
        //-----------------------//
        $('#id_overhead_yr1').bind('input',function(){
            calculate_yr1();
        });
        $('#id_overhead_yr2').bind('input',function(){
            calculate_yr2();
        });
        $('#id_overhead_yr3').bind('input',function(){
            calculate_yr3();
        });

        //-----------------------------//
        // SALES PER UNIT TEXT CHANGE  //
        //-----------------------------//
        $('#id_sales_per_unit_yr1').bind('input',function(){
            calculate_yr1();
        });
        $('#id_sales_per_unit_yr2').bind('input',function(){
            calculate_yr2();
        });
        $('#id_sales_per_unit_yr3').bind('input',function(){
            calculate_yr3();
        });
    }); // end DOCUMENT START

    //--------------------------------//
    // CALCULATE ALL THE ROWS AT ONCE //
    //--------------------------------//
    function calculate_yr1() {
        calculate_cogs('#id_materials_yr1', '#id_labour_yr1', '#id_overhead_yr1', '#id_total_cogs_yr1');
        calculate_profit_percent('#id_total_cogs_yr1', '#id_sales_per_unit_yr1', '#id_profit_percent_yr1');
        calculate_profit_amount('#id_total_cogs_yr1', '#id_sales_per_unit_yr1', '#id_profit_amount_yr1');
    }

    function calculate_yr2() {
        calculate_cogs('#id_materials_yr2', '#id_labour_yr2', '#id_overhead_yr2', '#id_total_cogs_yr2');
        calculate_profit_percent('#id_total_cogs_yr2', '#id_sales_per_unit_yr2', '#id_profit_percent_yr2');
        calculate_profit_amount('#id_total_cogs_yr2', '#id_sales_per_unit_yr2', '#id_profit_amount_yr2');
    }

    function calculate_yr3() {
        calculate_cogs('#id_materials_yr3', '#id_labour_yr3', '#id_overhead_yr3', '#id_total_cogs_yr3');
        calculate_profit_percent('#id_total_cogs_yr3', '#id_sales_per_unit_yr3', '#id_profit_percent_yr3');
        calculate_profit_amount('#id_total_cogs_yr3', '#id_sales_per_unit_yr3', '#id_profit_amount_yr3');
    }

    //----------------------------//
    // CALCULATE INDIVIDUAL ITEMS //
    //----------------------------//

    /**
     *  Function will take all the year-N inputs and calculate the TOTAL COGS
     *  if all the values where valid integers. If not valid then a NaN will be
     *  generated. The key idea is the developer passes in the ID of the inputs
     *  and this function will reference them and make the UI change accordingly.
     */
    function calculate_cogs(materials_id, labour_id, overhead_id, cogs_id) {
        // The sum total of the materials, labour and overhead.
        var total = 0;

        // Fetch the User inputs.
        var materials = parseFloat($(materials_id).val());
        var labour = parseFloat($(labour_id).val());
        var overhead = parseFloat($(overhead_id).val());

        // Calculate the sum (if not NaN).
        total += materials;
        total += labour;
        total += overhead;

        // Update the UI
        $(cogs_id).val(total);
    }

    /**
     *  Function will compute the profit percent.
     */
    function calculate_profit_percent(cogs_id, sales_id, profit_percent_id) {
        // The sum total of the materials, labour and overhead.
        var total = 0;

        // Fetch the User inputs.
        var cogs = parseFloat($(cogs_id).val());
        var sales_per_unit = parseFloat($(sales_id).val());

        // Calculate the amount (if not NaN).
        total = ( sales_per_unit - cogs ) / sales_per_unit * 100;

        // Update the UI
        $(profit_percent_id).val(total);
    }

    /**
     *  Function will compute the profit amount.
     */
    function calculate_profit_amount(cogs_id, sales_id, profit_amount_id) {
        // The sum total of the materials, labour and overhead.
        var total = 0;

        // Fetch the User inputs.
        var cogs = parseFloat($(cogs_id).val());
        var sales_per_unit = parseFloat($(sales_id).val());

        // Calculate the amount (if not NaN).
        total = sales_per_unit - cogs;

        // Update the UI
        $(profit_amount_id).val(total);
    }

    /**
     *  Function will load up the next URL after checking to see if the
     *  option was selected for this question.
     */
    function question_answer_protected_next(next_url) {
        window.location = next_url;
    }
</script>
{% endcompress %}
<!-- end JS -->
<!-- HTML -->
<fieldset>
    <legend>
        {{ node.order_num }}. {{ question.title|escape|safe }}
    </legend>
    <div class="form-group">
        <div class="col-sm-12">
            <!-- BIZMULA COGS TABLE -->
            <div class="table-responsive">
               <table class="table table-striped table-bordered table-hover">
                  <thead>
                     <tr>
                        <th>{% trans 'Item' %}</th>
                        <th>{% trans 'Year 1' %}</th>
                        <th>{% trans 'Year 2' %}</th>
                        <th>{% trans 'Year 3' %}</th>
                     </tr>
                  </thead>
                  <tbody>
                     <!-- MATERIALS -->
                     <tr>
                        <td>{% trans 'Materials' %}</td>
                        <td>
                            <input id="id_materials_yr1" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_materials_yr2" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_materials_yr3" type="number" class="form-control" placeholder="-" value="">
                        </td>
                     </tr>

                     <!-- LABOUR -->
                     <tr>
                        <td>{% trans 'Labour' %}</td>
                        <td>
                            <input id="id_labour_yr1" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_labour_yr2" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_labour_yr3" type="number" class="form-control" placeholder="-" value="">
                        </td>
                     </tr>

                     <!-- OVERHEAD -->
                     <tr>
                        <td>{% trans 'Overhead' %}</td>
                        <td>
                            <input id="id_overhead_yr1" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_overhead_yr2" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_overhead_yr3" type="number" class="form-control" placeholder="-" value="">
                        </td>
                     </tr>

                     <!-- TOTAL COGS -->
                     <tr>
                        <td>{% trans 'TOTAL COGS' %}</td>
                        <td>
                            <input id="id_total_cogs_yr1" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                        <td>
                            <input id="id_total_cogs_yr2" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                        <td>
                            <input id="id_total_cogs_yr3" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                     </tr>

                     <!-- SALES PRICE PER UNIT -->
                     <tr>
                        <td>{% trans 'Sales price per unit' %}</td>
                        <td>
                            <input id="id_sales_per_unit_yr1" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_sales_per_unit_yr2" type="number" class="form-control" placeholder="-" value="">
                        </td>
                        <td>
                            <input id="id_sales_per_unit_yr3" type="number" class="form-control" placeholder="-" value="">
                        </td>
                     </tr>

                     <!-- PROFIT % -->
                     <tr>
                        <td>{% trans 'Gross Margin/Profit Margin (%)' %}</td>
                        <td>
                            <input id="id_profit_percent_yr1" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                        <td>
                            <input id="id_profit_percent_yr2" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                        <td>
                            <input id="id_profit_percent_yr3" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                     </tr>

                     <!-- PROFIT $ -->
                     <tr>
                        <td>{% trans 'Gross Margin/Profit Margin ($)' %}</td>
                        <td>
                            <input id="id_profit_amount_yr1" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                        <td>
                            <input id="id_profit_amount_yr2" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                        <td>
                            <input id="id_profit_amount_yr3" type="number" class="form-control" placeholder="-" value="" readonly=true>
                        </td>
                     </tr>
                  </tbody>
               </table>
            </div>
            <!-- end BIZMULA COGS TABLE -->
        </div>
    </div>
</fieldset>
<!-- end HTML -->
